// Generated by CoffeeScript 1.3.1
(function() {
  var addFodder, addGreen, addQoutients, addRed, addSumsAndQuotients, colourFor, colourizeResults, fodder_list, round, setFodders;

  fodder_list = new FodderList;

  window.fodder_list = fodder_list;

  round = function(value) {
    return Math.round(value * 100) / 100;
  };

  addFodder = function() {
    var id;
    fodder_list.append(new Fodder);
    id = fodder_list.lastIndex();
    return jQuery('#fodder_header_table').append("<tr>\n  <td><input type=\"text\" class=\"fodder-name\" id=\"fodder_name_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_amount_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_solids_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_energy_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_protein_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_calcium_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_phosphor_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_magnesium_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_selenium_" + id + "\" /></td>\n  <td><div id=\"add_fodder\">LÃ¤gg till nytt foder</div></td>\n</tr>\n");
  };

  colourizeResults = function(totals) {
    colourFor(need.sufficentEnergy(totals.energy), '#total_energy');
    colourFor(need.sufficentProtein(totals.protein), '#total_protein');
    colourFor(need.suffientCalcium(totals.calcium), '#total_calcium');
    colourFor(need.suffientPhosphor(totals.phosphor), '#total_phosphor');
    colourFor(need.suffientMagnesium(totals.magnesium), '#total_magnesium');
    return colourFor(need.sufficientSelenium(totals.selenium), '#total_selenium');
  };

  addGreen = function(htmlElement) {
    jQuery(htmlElement).removeClass('red');
    return jQuery(htmlElement).addClass('green');
  };

  addRed = function(htmlElement) {
    jQuery(htmlElement).removeClass('green');
    return jQuery(htmlElement).addClass('red');
  };

  colourFor = function(sufficientNutrient, htmlElement) {
    if (sufficientNutrient) {
      return addGreen(htmlElement);
    } else {
      return addRed(htmlElement);
    }
  };

  addQoutients = function(htmlElement, nutrientToDivide, nutrientToDivideBy) {
    return jQuery(htmlElement).html(fodder_list.calculateQuotient(nutrientToDivide, nutrientToDivideBy));
  };

  addSumsAndQuotients = function(totals) {
    jQuery('#total_solids').html(round(totals.solids));
    jQuery('#total_energy').html(round(totals.energy));
    jQuery('#total_protein').html(round(totals.protein));
    jQuery('#total_calcium').html(round(totals.calcium));
    jQuery('#total_phosphor').html(round(totals.phosphor));
    jQuery('#total_magnesium').html(round(totals.magnesium));
    jQuery('#total_selenium').html(round(totals.selenium));
    addQoutients('#MJSmrp-quotient span', totals.protein, totals.energy);
    addQoutients('#CaP-quotient span', totals.calcium, totals.phosphor);
    addQoutients('#CaMg-quotient span', totals.calcium, totals.magnesium);
    return colourizeResults(totals);
  };

  String.prototype.capitalize = function() {
    return this.substr(0, 1).toUpperCase() + this.substr(1);
  };

  setFodders = function(elementName, elementId) {
    var nutrient;
    nutrient = elementName.capitalize();
    return eval("fodder_list.getFodderByIndex(elementId).set" + nutrient + ("(jQuery('#fodder_" + elementName + "_" + elementId + "').val())"));
  };

  jQuery(function() {
    addFodder();
    jQuery('#add_fodder').live('click', function() {
      return addFodder();
    });
    return jQuery('#fodder_header_table input').live('keyup', function() {
      var elementId, elementName, idString, _matchData, _ref;
      idString = jQuery(this).attr('id');
      _ref = idString.match(/_([a-z]+)_(\d+)/), _matchData = _ref[0], elementName = _ref[1], elementId = _ref[2];
      try {
        setFodders(elementName, elementId);
        jQuery('.fodder_error').html('');
      } catch (err) {
        jQuery('.fodder_error').html(err);
      }
      return addSumsAndQuotients(fodder_list.calculate());
    });
  });

}).call(this);
