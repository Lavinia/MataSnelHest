// Generated by CoffeeScript 1.3.1
(function() {
  var addFodder, addQoutients, addSumsAndQuotients, colourizeResults, fodder_list, needFulfilledColour, round;

  fodder_list = new FodderList;

  window.fodder_list = fodder_list;

  round = function(value) {
    return Math.round(value * 100) / 100;
  };

  addFodder = function() {
    var id;
    fodder_list.append(new Fodder);
    id = fodder_list.lastIndex();
    return jQuery('#fodder_header_table').append("<tr>\n  <td><input type=\"text\" class=\"fodder-name\" id=\"fodder_name_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_amount_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_solids_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_energy_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_protein_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_calcium_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_phosphor_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_magnesium_" + id + "\" /></td>\n  <td><input type=\"text\" id=\"fodder_selenium_" + id + "\" /></td>\n  <td><div id=\"add_fodder\">LÃ¤gg till nytt foder</div></td>\n</tr>\n");
  };

  colourizeResults = function(totals) {
    needFulfilledColour(need.sufficentEnergy(totals.energy), '#total_energy');
    needFulfilledColour(need.sufficentProtein(totals.protein), '#total_protein');
    needFulfilledColour(need.suffientCalcium(totals.calcium), '#total_calcium');
    needFulfilledColour(need.suffientPhosphor(totals.phosphor), '#total_phosphor');
    needFulfilledColour(need.suffientMagnesium(totals.magnesium), '#total_magnesium');
    return needFulfilledColour(need.sufficientSelenium(totals.selenium), '#total_selenium');
  };

  needFulfilledColour = function(method, htmlElement) {
    if (method) {
      jQuery(htmlElement).removeClass('red');
      return jQuery(htmlElement).addClass('green');
    } else {
      jQuery(htmlElement).removeClass('green');
      return jQuery(htmlElement).addClass('red');
    }
  };

  addQoutients = function(htmlElement, totals) {
    jQuery(htmlElement).html(fodder_list.calculateQuotient(totals.protein, totals.energy));
    return jQuery(htmlElement).html(fodder_list.calculateQuotient(totals.calcium, totals.phosphor));
  };

  addSumsAndQuotients = function(totals) {
    jQuery('#total_solids').html(round(totals.solids));
    jQuery('#total_energy').html(round(totals.energy));
    jQuery('#total_protein').html(round(totals.protein));
    jQuery('#total_calcium').html(round(totals.calcium));
    jQuery('#total_phosphor').html(round(totals.phosphor));
    jQuery('#total_magnesium').html(round(totals.magnesium));
    jQuery('#total_selenium').html(round(totals.selenium));
    addQoutients('#MJSmrp-quotient span', totals);
    addQoutients('#CaP-quotient span', totals);
    return colourizeResults(totals);
  };

  jQuery(function() {
    addFodder();
    jQuery('#add_fodder').live('click', function() {
      return addFodder();
    });
    return jQuery('#fodder_header_table input').live('keyup', function() {
      var elementId, elementName, idString, _matchData, _ref;
      idString = jQuery(this).attr('id');
      _ref = idString.match(/_([a-z]+)_(\d+)/), _matchData = _ref[0], elementName = _ref[1], elementId = _ref[2];
      fodder_list.getFodderByIndex(elementId)[elementName] = jQuery("#fodder_" + elementName + "_" + elementId).val();
      return addSumsAndQuotients(fodder_list.calculate());
    });
  });

}).call(this);
